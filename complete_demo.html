<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ExpenMan - Complete Expense Management System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
          sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
      .animate-slide-up { animation: slideUp 0.3s ease-out; }
      .animate-bounce-in { animation: bounceIn 0.6s ease-out; }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      
      @keyframes bounceIn {
        0% { transform: scale(0.3); opacity: 0; }
        50% { transform: scale(1.05); }
        70% { transform: scale(0.9); }
        100% { transform: scale(1); opacity: 1; }
      }
      
      .glass-effect {
        backdrop-filter: blur(16px);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .card-hover {
        transition: all 0.3s ease;
      }
      
      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel">
      const { useState, createContext, useContext } = React;

      // Countries with currencies
      const countries = [
        { name: 'India', currency: 'INR', symbol: '₹', flag: '🇮🇳' },
        { name: 'United States', currency: 'USD', symbol: '$', flag: '🇺🇸' },
        { name: 'United Kingdom', currency: 'GBP', symbol: '£', flag: '🇬🇧' },
        { name: 'Germany', currency: 'EUR', symbol: '€', flag: '🇩🇪' },
        { name: 'France', currency: 'EUR', symbol: '€', flag: '🇫🇷' },
        { name: 'Japan', currency: 'JPY', symbol: '¥', flag: '🇯🇵' },
        { name: 'Canada', currency: 'CAD', symbol: 'C$', flag: '🇨🇦' },
        { name: 'Australia', currency: 'AUD', symbol: 'A$', flag: '🇦🇺' },
        { name: 'China', currency: 'CNY', symbol: '¥', flag: '🇨🇳' },
        { name: 'Brazil', currency: 'BRL', symbol: 'R$', flag: '🇧🇷' },
        { name: 'Russia', currency: 'RUB', symbol: '₽', flag: '🇷🇺' },
        { name: 'South Korea', currency: 'KRW', symbol: '₩', flag: '🇰🇷' },
        { name: 'Mexico', currency: 'MXN', symbol: '$', flag: '🇲🇽' },
        { name: 'Italy', currency: 'EUR', symbol: '€', flag: '🇮🇹' },
        { name: 'Spain', currency: 'EUR', symbol: '€', flag: '🇪🇸' },
        { name: 'Netherlands', currency: 'EUR', symbol: '€', flag: '🇳🇱' },
        { name: 'Switzerland', currency: 'CHF', symbol: 'CHF', flag: '🇨🇭' },
        { name: 'Sweden', currency: 'SEK', symbol: 'kr', flag: '🇸🇪' },
        { name: 'Norway', currency: 'NOK', symbol: 'kr', flag: '🇳🇴' },
        { name: 'Denmark', currency: 'DKK', symbol: 'kr', flag: '🇩🇰' },
        { name: 'Singapore', currency: 'SGD', symbol: 'S$', flag: '🇸🇬' },
        { name: 'Hong Kong', currency: 'HKD', symbol: 'HK$', flag: '🇭🇰' },
        { name: 'South Africa', currency: 'ZAR', symbol: 'R', flag: '🇿🇦' },
        { name: 'UAE', currency: 'AED', symbol: 'د.إ', flag: '🇦🇪' },
        { name: 'Saudi Arabia', currency: 'SAR', symbol: '﷼', flag: '🇸🇦' },
        { name: 'Turkey', currency: 'TRY', symbol: '₺', flag: '🇹🇷' },
        { name: 'Israel', currency: 'ILS', symbol: '₪', flag: '🇮🇱' },
        { name: 'Thailand', currency: 'THB', symbol: '฿', flag: '🇹🇭' },
        { name: 'Malaysia', currency: 'MYR', symbol: 'RM', flag: '🇲🇾' },
        { name: 'Indonesia', currency: 'IDR', symbol: 'Rp', flag: '🇮🇩' }
      ];

      const generatePassword = () => {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$';
        let password = '';
        for (let i = 0; i < 12; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return password;
      };

      const AppContext = createContext();

      const AppProvider = ({ children }) => {
        const [user, setUser] = useState(null);
        const [users, setUsers] = useState([]);
        const [expenses, setExpenses] = useState([]);
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);
        const [notification, setNotification] = useState(null);

        const showNotification = (message, type = 'success') => {
          setNotification({ message, type });
          setTimeout(() => setNotification(null), 4000);
        };

        const registerAdmin = async (adminData) => {
          setIsLoading(true);
          try {
            const newAdmin = {
              ...adminData,
              id: Date.now().toString(),
              role: 'admin',
              createdAt: new Date().toISOString()
            };
            setUsers([newAdmin]);
            setUser(newAdmin);
            showNotification('Admin registered successfully!', 'success');
          } catch (err) {
            setError('Registration failed');
          } finally {
            setIsLoading(false);
          }
        };

        const login = async (email, password) => {
          setIsLoading(true);
          setError(null);
          try {
            const foundUser = users.find(u => u.email === email && u.password === password);
            if (foundUser) {
              setUser(foundUser);
              showNotification(`Welcome back, ${foundUser.name}!`, 'success');
            } else {
              setError('Invalid credentials');
            }
          } catch (err) {
            setError('Login failed');
          } finally {
            setIsLoading(false);
          }
        };

        const logout = () => {
          setUser(null);
          showNotification('Logged out successfully.', 'info');
        };

        const addUser = async (userData) => {
          setIsLoading(true);
          try {
            const newUser = {
              ...userData,
              id: Date.now().toString(),
              password: generatePassword(),
              createdAt: new Date().toISOString()
            };
            setUsers(prev => [...prev, newUser]);
            showNotification(`${userData.role} added successfully!`, 'success');
            return newUser;
          } catch (err) {
            setError('Failed to add user');
          } finally {
            setIsLoading(false);
          }
        };

        const submitExpense = async (expenseData) => {
          setIsLoading(true);
          try {
            const newExpense = {
              ...expenseData,
              id: Date.now().toString(),
              status: 'pending',
              approvals: [],
              createdAt: new Date().toISOString(),
              updatedAt: new Date().toISOString()
            };
            setExpenses(prev => [newExpense, ...prev]);
            showNotification('Expense submitted successfully!', 'success');
          } catch (err) {
            setError('Failed to submit expense');
          } finally {
            setIsLoading(false);
          }
        };

        const approveExpense = async (expenseId, managerId, action, remarks = '') => {
          setIsLoading(true);
          try {
            setExpenses(prev => prev.map(expense => {
              if (expense.id === expenseId) {
                const manager = users.find(u => u.id === managerId);
                const newApproval = {
                  managerId,
                  managerName: manager?.name,
                  action,
                  remarks,
                  timestamp: new Date().toISOString()
                };
                
                const updatedApprovals = [...expense.approvals, newApproval];
                const approvalCount = updatedApprovals.filter(a => a.action === 'approved').length;
                const totalManagers = users.filter(u => u.role === 'manager' || u.role === 'cfo').length;
                const approvalRate = totalManagers > 0 ? (approvalCount / totalManagers) * 100 : 0;
                
                let newStatus = expense.status;
                if (manager?.role === 'cfo' && action === 'approved') {
                  newStatus = 'approved';
                } else if (action === 'rejected') {
                  newStatus = 'rejected';
                } else if (approvalRate >= 60) {
                  newStatus = 'approved';
                }
                
                return {
                  ...expense,
                  approvals: updatedApprovals,
                  status: newStatus,
                  updatedAt: new Date().toISOString()
                };
              }
              return expense;
            }));
            showNotification(`Expense ${action} successfully!`, 'success');
          } catch (err) {
            setError('Failed to process expense');
          } finally {
            setIsLoading(false);
          }
        };

        return (
          <AppContext.Provider value={{
            user,
            users,
            expenses,
            isLoading,
            error,
            notification,
            registerAdmin,
            login,
            logout,
            addUser,
            submitExpense,
            approveExpense,
            showNotification
          }}>
            {children}
          </AppContext.Provider>
        );
      };

      const useApp = () => {
        const context = useContext(AppContext);
        if (!context) {
          throw new Error('useApp must be used within an AppProvider');
        }
        return context;
      };

      const Notification = () => {
        const { notification } = useApp();
        
        if (!notification) return null;

        const getNotificationStyles = (type) => {
          switch (type) {
            case 'success': return 'bg-green-500 border-green-400';
            case 'error': return 'bg-red-500 border-red-400';
            case 'info': return 'bg-blue-500 border-blue-400';
            default: return 'bg-gray-500 border-gray-400';
          }
        };

        const getIcon = (type) => {
          switch (type) {
            case 'success': return '✅';
            case 'error': return '❌';
            case 'info': return 'ℹ️';
            default: return '📢';
          }
        };

        return (
          <div className="fixed top-4 right-4 z-50 animate-slide-up">
            <div className={`${getNotificationStyles(notification.type)} text-white px-6 py-4 rounded-xl shadow-lg border flex items-center gap-3 max-w-sm`}>
              <span className="text-xl">{getIcon(notification.type)}</span>
              <span className="font-medium">{notification.message}</span>
            </div>
          </div>
        );
      };

      const LoginPage = () => {
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [showPassword, setShowPassword] = useState(false);
        const [adminForm, setAdminForm] = useState({
          name: '',
          email: '',
          password: '',
          company: '',
          country: 'India'
        });
        const { login, registerAdmin, isLoading, error, users } = useApp();

        const handleLogin = async (e) => {
          e.preventDefault();
          await login(email, password);
        };

        const handleRegister = async (e) => {
          e.preventDefault();
          const selectedCountry = countries.find(c => c.name === adminForm.country);
          await registerAdmin({
            ...adminForm,
            currency: selectedCountry.currency,
            currencySymbol: selectedCountry.symbol
          });
        };

        const selectedCountry = countries.find(c => c.name === adminForm.country);

        return (
          <div className="min-h-screen relative overflow-hidden animate-fade-in">
            <div
              className="absolute inset-0 bg-cover bg-center bg-no-repeat"
              style={{
                backgroundImage: 'url(https://images.unsplash.com/photo-1551434678-e076c223a692?w=1920&h=1080&fit=crop)',
              }}
            >
              <div className="absolute inset-0 bg-gradient-to-br from-emerald-900/80 via-slate-900/85 to-teal-900/80"></div>
            </div>

            <div className="relative z-10 min-h-screen flex items-center justify-center px-6 py-12">
              <div className="max-w-md w-full animate-bounce-in">
                <div className="text-center mb-8">
                  <div className="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl mb-6 shadow-2xl">
                    <span className="text-3xl">💰</span>
                  </div>
                  <h1 className="text-4xl md:text-5xl font-bold text-white tracking-wide mb-4 bg-gradient-to-r from-emerald-300 to-teal-300 bg-clip-text text-transparent">
                    EXPENMAN
                  </h1>
                  <p className="text-white/80 text-lg font-medium">Smart Expense Management</p>
                </div>

                <div className="glass-effect p-8 rounded-3xl shadow-2xl">
                  {users.length === 0 ? (
                    <form onSubmit={handleRegister} className="space-y-6">
                      <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-white mb-2">Register Admin</h2>
                        <p className="text-white/70">Create your admin account to get started</p>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Name *</label>
                        <input
                          type="text"
                          value={adminForm.name}
                          onChange={(e) => setAdminForm({ ...adminForm, name: e.target.value })}
                          className="w-full px-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                          placeholder="Enter your full name"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Email *</label>
                        <input
                          type="email"
                          value={adminForm.email}
                          onChange={(e) => setAdminForm({ ...adminForm, email: e.target.value })}
                          className="w-full px-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                          placeholder="Enter your email"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Password *</label>
                        <input
                          type="password"
                          value={adminForm.password}
                          onChange={(e) => setAdminForm({ ...adminForm, password: e.target.value })}
                          className="w-full px-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                          placeholder="Enter your password"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Company *</label>
                        <input
                          type="text"
                          value={adminForm.company}
                          onChange={(e) => setAdminForm({ ...adminForm, company: e.target.value })}
                          className="w-full px-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                          placeholder="Enter your company name"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Country/Region *</label>
                        <select
                          value={adminForm.country}
                          onChange={(e) => setAdminForm({ ...adminForm, country: e.target.value })}
                          className="w-full px-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                          required
                        >
                          {countries.map((country) => (
                            <option key={country.name} value={country.name} className="bg-slate-800 text-white">
                              {country.flag} {country.name}
                            </option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Currency</label>
                        <div className="w-full px-4 py-4 bg-white/5 border border-white/10 rounded-xl text-white/80">
                          {selectedCountry?.flag} {selectedCountry?.currency} ({selectedCountry?.symbol})
                        </div>
                      </div>

                      <button
                        type="submit"
                        disabled={isLoading}
                        className="w-full group inline-flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl shadow-emerald-500/50 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <span className="text-xl">🚀</span>
                        <span>{isLoading ? 'Registering...' : 'Register Admin'}</span>
                        {isLoading && <div className="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>}
                      </button>

                      {error && (
                        <div className="bg-red-500/20 border border-red-400/30 text-red-200 px-4 py-3 rounded-xl animate-slide-up">
                          <div className="flex items-center gap-2">
                            <span>⚠️</span>
                            <span>{error}</span>
                          </div>
                        </div>
                      )}
                    </form>
                  ) : (
                    <form onSubmit={handleLogin} className="space-y-6">
                      <div className="text-center mb-6">
                        <h2 className="text-2xl font-bold text-white mb-2">Welcome Back</h2>
                        <p className="text-white/70">Sign in to your account</p>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Email Address</label>
                        <div className="relative">
                          <span className="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/60">📧</span>
                          <input
                            type="email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="w-full pl-12 pr-4 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                            placeholder="Enter your email"
                            required
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-white/90 mb-3">Password</label>
                        <div className="relative">
                          <span className="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/60">🔒</span>
                          <input
                            type={showPassword ? 'text' : 'password'}
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="w-full pl-12 pr-12 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-transparent"
                            placeholder="Enter your password"
                            required
                          />
                          <button
                            type="button"
                            onClick={() => setShowPassword(!showPassword)}
                            className="absolute right-4 top-1/2 transform -translate-y-1/2 text-white/60 hover:text-white transition-colors"
                          >
                            {showPassword ? '🙈' : '👁️'}
                          </button>
                        </div>
                      </div>

                      <button
                        type="submit"
                        disabled={isLoading}
                        className="w-full group inline-flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 text-white font-bold rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-2xl shadow-emerald-500/50 disabled:opacity-50 disabled:cursor-not-allowed"
                      >
                        <span className="text-xl">🚀</span>
                        <span>{isLoading ? 'Signing In...' : 'Sign In'}</span>
                        {isLoading && <div className="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div>}
                      </button>

                      {error && (
                        <div className="bg-red-500/20 border border-red-400/30 text-red-200 px-4 py-3 rounded-xl animate-slide-up">
                          <div className="flex items-center gap-2">
                            <span>⚠️</span>
                            <span>{error}</span>
                          </div>
                        </div>
                      )}
                    </form>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const { user } = useApp();

        const renderDashboard = () => {
          if (!user) return <LoginPage />;
          
          switch (user.role) {
            case 'admin':
              return <div className="p-8 text-center">Admin Dashboard - Coming Soon</div>;
            case 'manager':
            case 'cfo':
              return <div className="p-8 text-center">Manager Dashboard - Coming Soon</div>;
            case 'employee':
              return <div className="p-8 text-center">Employee Dashboard - Coming Soon</div>;
            default:
              return <LoginPage />;
          }
        };

        return (
          <>
            <Notification />
            {renderDashboard()}
          </>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <AppProvider>
          <App />
        </AppProvider>
      );
    </script>
  </body>
</html>